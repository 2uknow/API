<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danal API Monitor</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%23667eea'/><stop offset='100%25' style='stop-color:%23764ba2'/></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23g)' stroke='%23fff' stroke-width='3'/><path d='M35 35 L50 20 L65 35 L50 50 Z' fill='%23fff'/><path d='M35 65 L50 50 L65 65 L50 80 Z' fill='%23fff' opacity='0.8'/></svg>" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Ïª§Ïä§ÌÖÄ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        .header-clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .header-clickable:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-purple-50 text-slate-800 min-h-screen">
    <div class="max-w-[95vw] mx-auto p-4 space-y-6">
        <!-- Í∞úÏÑ†Îêú Ìó§Îçî (ÌÅ¥Î¶≠ Í∞ÄÎä•) -->
        <header class="glass-effect rounded-2xl shadow-lg p-6 fade-in">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center pulse-glow">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <div class="header-clickable" onclick="refreshDashboard()">
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                            Danal API Monitor
                        </h1>
                        <p class="text-sm text-slate-500">Ïã§ÏãúÍ∞Ñ API ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ - ÌÅ¥Î¶≠ÌïòÏó¨ ÏÉàÎ°úÍ≥†Ïπ®</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <span id="statusChip" class="text-xs px-3 py-2 rounded-full bg-slate-200 shadow-sm transition-all duration-300">Standby</span>
                    <a href="/alert-config.html" class="px-4 py-2 text-sm bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                        üîî Alert Settings
                    </a>
                </div>
            </div>
        </header>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <section class="grid grid-cols-1 2xl:grid-cols-5 gap-4">
            <!-- ÏûëÏóÖ Ïã§Ìñâ Ìå®ÎÑê -->
            <div class="2xl:col-span-1 glass-effect rounded-2xl shadow-lg p-4 space-y-3 card-hover fade-in">
                <div class="flex items-center space-x-2 mb-4">
                    <div class="w-3 h-3 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full"></div>
                    <h2 class="text-lg font-semibold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                        Job Selection & Execution
                    </h2>
                </div>
                
                <select id="jobSelect" class="w-full border-2 border-slate-200 rounded-xl px-4 py-3 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300">
                    <option value="">Select a job...</option>
                </select>
                
                <div class="flex gap-3">
                    <button id="runBtn" class="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 text-white disabled:opacity-50 flex-1 font-medium shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 disabled:transform-none">
                        üöÄ Run
                    </button>
                </div>
                
                <div class="space-y-2">
                    <h3 class="text-sm font-medium text-slate-600">Current Job Configuration</h3>
                    <div id="jobSummary" class="text-sm bg-gradient-to-r from-slate-50 to-blue-50 border-2 border-slate-200 rounded-xl p-4 min-h-[50px] transition-all duration-300"></div>
                </div>
                
                <!-- Ïã§ÏãúÍ∞Ñ Î°úÍ∑∏ -->
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-sm font-medium text-slate-600">Real-time Log</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="expandLogModal" class="text-xs text-blue-600 hover:text-blue-800 px-3 py-1.5 bg-blue-50 rounded-lg hover:bg-blue-100 transition-all duration-300 font-medium">
                                üîç Full Screen
                            </button>
                            <button id="clearConsole" class="text-xs text-gray-600 hover:text-gray-800 px-3 py-1.5 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all duration-300 font-medium">
                                üóëÔ∏è Clear
                            </button>
                            <div id="logIndicator" class="w-3 h-3 bg-gray-400 rounded-full transition-all duration-300"></div>
                        </div>
                    </div>
                    <div id="console" class="bg-slate-900 text-green-400 text-sm p-4 rounded-xl h-52 overflow-y-auto font-mono leading-relaxed shadow-inner border-2 border-slate-700"></div>
                </div>
           
                <!-- Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨ -->
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-xl p-4 card-hover">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <span class="text-sm font-medium text-purple-800">Schedule Management</span>
                                <div id="scheduleStatus" class="text-xs text-purple-600">Automated Execution</div>
                            </div>
                        </div>
                        <button id="scheduleToggle" class="px-3 py-1.5 text-xs bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-all duration-300 font-medium">
                            Manage
                        </button>
                    </div>
                    <div id="scheduleIndicator" class="text-xs text-purple-600">Loading...</div>
                    <div id="scheduleList" class="mt-2 space-y-1 max-h-24 overflow-y-auto"></div>
                </div>
            </div>

            <!-- ÌÜµÍ≥Ñ ÎåÄÏãúÎ≥¥Îìú -->
            <div class="2xl:col-span-4 space-y-4">
                <!-- ÌÜµÍ≥Ñ Ïπ¥ÎìúÎì§ -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                    <!-- Ï¥ù ÏÑ±Í≥µÎ•† -->
                    <div class="glass-effect rounded-xl p-3 border-l-4 border-emerald-500 card-hover fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-medium text-emerald-600">Ï¥ù ÏÑ±Í≥µÎ•†</p>
                                <p id="totalSuccess" class="text-xl font-bold text-emerald-700">-%</p>
                            </div>
                            <div class="w-8 h-8 bg-emerald-100 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- ÌèâÍ∑† ÏùëÎãµÏãúÍ∞Ñ -->
                    <div class="glass-effect rounded-xl p-3 border-l-4 border-blue-500 card-hover fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-medium text-blue-600">ÌèâÍ∑† ÏùëÎãµÏãúÍ∞Ñ</p>
                                <p id="avgResponse" class="text-xl font-bold text-blue-700">-ms</p>
                            </div>
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- ÌôúÏÑ± Ïû° -->
                    <div class="glass-effect rounded-xl p-3 border-l-4 border-purple-500 card-hover fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-medium text-purple-600">ÌôúÏÑ± Ïû°</p>
                                <p id="activeJobs" class="text-xl font-bold text-purple-700">-</p>
                            </div>
                            <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Ïò§Îäò Ïã§Ìñâ -->
                    <div class="glass-effect rounded-xl p-3 border-l-4 border-amber-500 card-hover fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs font-medium text-amber-600">Ïò§Îäò Ïã§Ìñâ</p>
                                <p id="todayRuns" class="text-xl font-bold text-amber-700">-</p>
                            </div>
                            <div class="w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ïã§Ìñâ Ïù¥Î†• -->
                <div class="glass-effect rounded-2xl shadow-lg p-4 fade-in">
                    <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-4 gap-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 bg-gradient-to-r from-green-500 to-blue-500 rounded-full"></div>
                            <h2 class="text-lg font-semibold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
                                Execution History
                            </h2>
                        </div>
                        
                        <!-- ÌïÑÌÑ∞ Ïª®Ìä∏Î°§ -->
                        <div class="flex flex-wrap items-center gap-2">
                            <select id="filterJob" class="border border-slate-200 rounded-lg px-2 py-1.5 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all duration-300">
                                <option value="">All Jobs</option>
                            </select>
                            <select id="range" class="border border-slate-200 rounded-lg px-2 py-1.5 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all duration-300">
                                <option value="">All Time</option>
                                <option value="24h">24 Hours</option>
                                <option value="7d">7 Days</option>
                            </select>
                            <input id="searchText" placeholder="Search..." class="border border-slate-200 rounded-lg px-2 py-1.5 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-200 transition-all duration-300 min-w-[120px]" />
                            <button id="searchBtn" class="px-3 py-1.5 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg hover:from-blue-600 hover:to-purple-600 transition-all duration-300 text-sm font-medium shadow-md hover:shadow-lg">
                                üîç Search
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÌÖåÏù¥Î∏î -->
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-slate-200">
                                    <th class="text-left py-3 px-2 text-sm font-semibold text-slate-600">Time</th>
                                    <th class="text-left py-3 px-2 text-sm font-semibold text-slate-600">Job</th>
                                    <th class="text-left py-3 px-2 text-sm font-semibold text-slate-600">Status</th>
                                    <th class="text-left py-3 px-2 text-sm font-semibold text-slate-600">Summary</th>
                                    <th class="text-left py-3 px-2 text-sm font-semibold text-slate-600">Duration</th>
                                    <th class="text-left py-3 px-2 text-sm font-semibold text-slate-600">Report</th>
                                    <th class="text-left py-3 px-2 text-sm font-semibold text-slate-600">Log</th>
                                </tr>
                            </thead>
                            <tbody id="histTbody" class="divide-y divide-slate-100">
                                <!-- ÎèôÏ†Å ÏÉùÏÑ± -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- ÌéòÏù¥Ïßï -->
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mt-4 pt-3 border-t border-slate-200 gap-2">
                        <div id="paginationInfo" class="text-sm text-slate-600 text-center sm:text-left"></div>
                        <div id="paginationControls" class="flex items-center justify-center sm:justify-end space-x-1 flex-wrap"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Î°úÍ∑∏ Î™®Îã¨ -->
        <div id="logModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="glass-effect rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col">
                    <div class="flex items-center justify-between p-6 border-b border-slate-200">
                        <h3 class="text-xl font-semibold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                            Real-time Log - Full Screen
                        </h3>
                        <div class="flex items-center space-x-3">
                            <button id="clearModalConsole" class="px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-300">
                                üóëÔ∏è Clear
                            </button>
                            <button id="closeLogModal" class="px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg hover:from-red-600 hover:to-pink-600 transition-all duration-300">
                                ‚úï Close
                            </button>
                        </div>
                    </div>
                    <div id="modalConsole" class="flex-1 bg-slate-900 text-green-400 text-sm p-6 font-mono leading-relaxed overflow-y-auto m-6 rounded-xl shadow-inner"></div>
                </div>
            </div>
        </div>

        <!-- ÌååÏùº ÎÇ¥Ïö© Î™®Îã¨ -->
        <div id="fileModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="glass-effect rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                    <div class="flex items-center justify-between p-6 border-b border-slate-200">
                        <h3 id="fileModalTitle" class="text-xl font-semibold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                            File Content
                        </h3>
                        <button id="closeFileModal" class="px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg hover:from-red-600 hover:to-pink-600 transition-all duration-300">
                            ‚úï Close
                        </button>
                    </div>
                    <div id="fileContent" class="flex-1 bg-slate-900 text-green-400 text-sm p-6 font-mono leading-relaxed overflow-y-auto m-6 rounded-xl shadow-inner whitespace-pre-wrap"></div>
                </div>
            </div>
        </div>

        <!-- Ìë∏ÌÑ∞ -->
        <footer class="glass-effect rounded-2xl shadow-lg p-6 fade-in">
            <div class="flex flex-col md:flex-row justify-between items-center text-sm text-slate-600 space-y-3 md:space-y-0">
                <div class="flex flex-col md:flex-row items-center space-y-1 md:space-y-0 md:space-x-4">
                    <span class="font-medium bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        ¬© 2025 Danal API Monitor
                    </span>
                </div>
                
                <!-- Í∞úÎ∞úÏûê Ï†ïÎ≥¥ -->
                <div class="flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-6">
                    <div class="flex items-center space-x-3">
                        <span class="text-slate-400">Developed by</span>
                        <div class="flex items-center space-x-2">
                            <div class="flex items-center space-x-1 px-2 py-1 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-full border border-blue-100">
                                <div class="w-5 h-5 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                </div>
                                <span class="text-blue-700 font-medium text-xs">2uknow</span>
                            </div>
                            <span class="text-slate-300">&</span>
                            <div class="flex items-center space-x-1 px-2 py-1 bg-gradient-to-r from-emerald-50 to-green-50 rounded-full border border-emerald-100">
                                <div class="w-5 h-5 bg-gradient-to-r from-emerald-500 to-green-600 rounded-full flex items-center justify-center">
                                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                                    </svg>
                                </div>
                                <span class="text-emerald-700 font-medium text-xs">hnkim</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2 text-slate-400">
                        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span id="currentTime" class="font-mono text-sm tracking-wider">--:--:--</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨ Î™®Îã¨ -->
    <div id="scheduleModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass-effect rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                <div class="flex items-center justify-between p-6 border-b border-slate-200">
                    <h3 class="text-xl font-semibold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                        Schedule Management
                    </h3>
                    <button id="closeScheduleModal" class="px-4 py-2 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg hover:from-red-600 hover:to-pink-600 transition-all duration-300">
                        ‚úï Close
                    </button>
                </div>
                
                <div class="flex-1 p-6 overflow-y-auto">
                    <div class="mb-6 p-4 bg-purple-50 rounded-xl border border-purple-200">
                        <h4 class="font-medium mb-3 text-purple-800">Add New Schedule</h4>
                        <form id="scheduleForm" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1 text-slate-700">Job</label>
                                    <select id="modalJobSelect" class="w-full border-2 border-slate-200 rounded-lg px-3 py-2 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-300" required>
                                        <option value="">Select a job...</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1 text-slate-700">Cron Expression</label>
                                    <input type="text" id="cronExpr" class="w-full border-2 border-slate-200 rounded-lg px-3 py-2 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-300" placeholder="Every minute: * * * * *" required>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-2">
                                <span class="text-sm text-slate-600 font-medium">Quick Select:</span>
                                <button type="button" onclick="setCronExpression('* * * * *')" class="px-3 py-1 text-sm bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-lg transition-colors">Every minute</button>
                                <button type="button" onclick="setCronExpression('*/5 * * * *')" class="px-3 py-1 text-sm bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-lg transition-colors">Every 5 min</button>
                                <button type="button" onclick="setCronExpression('0 9 * * *')" class="px-3 py-1 text-sm bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-lg transition-colors">9 AM daily</button>
                            </div>
                            
                            <button type="submit" class="px-6 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all duration-300 font-medium shadow-lg">
                                Add Schedule
                            </button>
                        </form>
                    </div>

                    <div>
                        <h4 class="font-medium mb-3 text-slate-800">Current Schedules</h4>
                        <div id="modalScheduleList" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
      let jobs = [];
      let historyRaw = [];
      let historyView = [];
      let totalItems = 0;
      let totalPages = 0;
      let currentPage = 1;
      let pageSize = 10; // Í∏∞Ï°¥ ÏΩîÎìúÏôÄ ÏùºÏπò
      let running = null;
      let schedules = [];
      let stateSource = null;
      let logSource = null;

        // Ìó§Îçî ÌÅ¥Î¶≠ Í∏∞Îä• Ï∂îÍ∞Ä
        function refreshDashboard() {
            const baseUrl = getBaseUrl();
            if (baseUrl && baseUrl !== window.location.origin) {
                window.location.href = baseUrl;
            } else {
                window.location.reload();
            }
        }

        // base_url Í∞ÄÏ†∏Ïò§Í∏∞ Ìï®Ïàò
        function getBaseUrl() {
            return window.location.origin;
        }

        // DOM Î°úÎìú ÏôÑÎ£å Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Danal API Monitor Ï¥àÍ∏∞Ìôî ÏãúÏûë');
            
            fetchJobs();
            fetchHistory();
            loadSchedules();
            connectSSE();
            setupEventListeners();
            updateCurrentTime();
            
            setInterval(updateStats, 30000);
            setInterval(updateCurrentTime, 1000); // ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
            
            console.log('‚úÖ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        });

        // ÌòÑÏû¨ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { 
                hour12: false,
                timeZone: 'Asia/Seoul',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // ÏãúÎ∂ÑÏ¥àÎ•º Î∂ÑÎ¶¨Ìï¥ÏÑú Ïä§ÌÉÄÏùºÎßÅ
            const [hours, minutes, seconds] = timeString.split(':');
            const styledTime = `<span class="text-blue-400">${hours}</span><span class="text-slate-300">:</span><span class="text-blue-400">${minutes}</span><span class="text-slate-300">:</span><span class="text-blue-400">${seconds}</span>`;
            
            document.getElementById('currentTime').innerHTML = styledTime;
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupEventListeners() {
          
            document.getElementById('runBtn').addEventListener('click', () => {
                const jobName = document.getElementById('jobSelect').value;
                if (!jobName) {
                    alert('Please select a job.');
                    return;
                }
                runJob(jobName);
            });

            document.getElementById('jobSelect').addEventListener('change', updateJobSummary);

            document.getElementById('searchBtn').addEventListener('click', () => {
                currentPage = 1;
                fetchHistory();
            });

            document.getElementById('searchText').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    currentPage = 1;
                    fetchHistory();
                }
            });

            document.getElementById('filterJob').addEventListener('change', () => {
                currentPage = 1;
                fetchHistory();
            });

            document.getElementById('range').addEventListener('change', () => {
                currentPage = 1;
                fetchHistory();
            });

            document.getElementById('clearConsole').addEventListener('click', () => {
                document.getElementById('console').innerHTML = '';
            });

            document.getElementById('expandLogModal').addEventListener('click', () => {
                document.getElementById('logModal').classList.remove('hidden');
                syncConsoles();
            });

            document.getElementById('closeLogModal').addEventListener('click', () => {
                document.getElementById('logModal').classList.add('hidden');
            });

            document.getElementById('clearModalConsole').addEventListener('click', () => {
                document.getElementById('modalConsole').innerHTML = '';
                document.getElementById('console').innerHTML = '';
            });

            document.getElementById('closeFileModal').addEventListener('click', () => {
                document.getElementById('fileModal').classList.add('hidden');
            });

            // Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨ Î™®Îã¨
            document.getElementById('scheduleToggle').addEventListener('click', () => {
                document.getElementById('scheduleModal').classList.remove('hidden');
                loadModalSchedules();
            });

            document.getElementById('closeScheduleModal').addEventListener('click', () => {
                document.getElementById('scheduleModal').classList.add('hidden');
            });

            // Ïä§ÏºÄÏ§Ñ Ìèº Ï†úÏ∂ú
            document.getElementById('scheduleForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const jobName = document.getElementById('modalJobSelect').value;
                const cronExpr = document.getElementById('cronExpr').value.trim();
                
                if (!jobName || !cronExpr) {
                    alert('Please fill in all fields.');
                    return;
                }
                
                addSchedule(jobName, cronExpr);
            });

            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('log-link')) {
                    e.preventDefault();
                    const logUrl = e.target.dataset.logUrl;
                    showLogFile(logUrl);
                }
            });
            const runBtn = document.getElementById('runBtn');
    if (runBtn) {
        let isProcessing = false;
        
        runBtn.addEventListener('click', async () => {
            if (isProcessing) {
                console.log('[CLIENT] Button click ignored - already processing');
                return;
            }
            
            const jobName = document.getElementById('jobSelect').value;
            if (!jobName) {
                showNotification('Please select a job first', 'error');
                return;
            }
            
            isProcessing = true;
            
            try {
                await runJob(jobName);
            } catch (error) {
                console.error('Run job error:', error);
            } finally {
                // ÏïΩÍ∞ÑÏùò ÏßÄÏó∞ ÌõÑ Îã§Ïãú ÌôúÏÑ±Ìôî (Ï§ëÎ≥µ ÌÅ¥Î¶≠ Î∞©ÏßÄ)
                setTimeout(() => {
                    isProcessing = false;
                }, 1000);
            }
        });
        }
    }

        // Ïä§ÏºÄÏ§Ñ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
        async function loadSchedules() {
            try {
                const response = await fetch('/api/schedule');
                schedules = await response.json();
                updateScheduleStatus();
            } catch (error) {
                console.error('Failed to load schedules:', error);
                document.getElementById('scheduleIndicator').textContent = 'Error loading schedules';
            }
        }

        function updateScheduleStatus() {
            const indicator = document.getElementById('scheduleIndicator');
            const list = document.getElementById('scheduleList');
            
            if (schedules.length === 0) {
                indicator.textContent = 'No schedules';
                list.innerHTML = '<div class="text-xs text-purple-500">No registered schedules</div>';
            } else {
                indicator.textContent = `${schedules.length} active schedule(s)`;
                list.innerHTML = schedules.slice(0, 3).map(s => `
                    <div class="flex items-center justify-between py-1 px-2 bg-white rounded border border-purple-100">
                        <div>
                            <div class="font-medium text-xs text-purple-800">${s.name}</div>
                            <div class="text-xs text-purple-600 font-mono">${s.cronExpr}</div>
                        </div>
                        <button onclick="deleteSchedule('${s.name}')" class="text-red-600 hover:text-red-800 text-xs px-1">üóëÔ∏è</button>
                    </div>
                `).join('');
                
                if (schedules.length > 3) {
                    list.innerHTML += `<div class="text-xs text-purple-500 text-center">+${schedules.length - 3} more...</div>`;
                }
            }
        }

        function loadModalSchedules() {
            const modalJobSelect = document.getElementById('modalJobSelect');
            modalJobSelect.innerHTML = '<option value="">Select a job...</option>';
            
            jobs.forEach(job => {
                modalJobSelect.insertAdjacentHTML('beforeend', 
                    `<option value="${job.name}">${job.name} (${job.type})</option>`
                );
            });
            
            renderModalScheduleList();
        }

        function renderModalScheduleList() {
            const container = document.getElementById('modalScheduleList');
            if (schedules.length === 0) {
                container.innerHTML = '<div class="text-center text-slate-500 py-4">No registered schedules</div>';
                return;
            }
            container.innerHTML = schedules.map(s => `
                <div class="flex items-center justify-between p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors">
                    <div class="flex-1">
                        <div class="font-medium text-slate-800">${s.name}</div>
                        <div class="text-sm text-slate-600 font-mono">${s.cronExpr}</div>
                    </div>
                    <button onclick="deleteSchedule('${s.name}')" class="px-3 py-1.5 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors">
                        Delete
                    </button>
                </div>
            `).join('');
        }

        function setCronExpression(expression) {
            document.getElementById('cronExpr').value = expression;
        }

        async function addSchedule(jobName, cronExpr) {
            try {
                const response = await fetch('/api/schedule', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: jobName, cronExpr })
                });
                
                if (!response.ok) throw new Error(`Server error (${response.status})`);
                
                showNotification('Schedule added successfully', 'success');
                await loadSchedules();
                loadModalSchedules();
                document.getElementById('scheduleForm').reset();
            } catch (error) {
                showNotification(`Failed to add schedule: ${error.message}`, 'error');
            }
        }

        async function deleteSchedule(name) {
            if (!confirm(`Delete "${name}" schedule?`)) return;
            
            try {
                const response = await fetch(`/api/schedule/${name}`, { method: 'DELETE' });
                if (response.ok) {
                    showNotification('Schedule deleted successfully', 'success');
                    await loadSchedules();
                    loadModalSchedules();
                } else {
                    throw new Error('Delete failed');
                }
            } catch (error) {
                showNotification('Failed to delete schedule', 'error');
            }
        }

        // ÏûëÏóÖ Î™©Î°ù Í∞ÄÏ†∏Ïò§Í∏∞
   
async function fetchJobs() {
    try {
        const response = await fetch('/api/jobs');
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        jobs = await response.json();
        
        const jobSelect = document.getElementById('jobSelect');
        const filterJob = document.getElementById('filterJob');
        
        if (jobSelect) {
            jobSelect.innerHTML = '<option value="">Select a job...</option>';
            jobs.forEach(job => {
                const jobOption = `<option value="${job.name}">${job.name} (${job.type})</option>`;
                jobSelect.insertAdjacentHTML('beforeend', jobOption);
            });
        }
        
        if (filterJob) {
            filterJob.innerHTML = '<option value="">All Jobs</option>';
            jobs.forEach(job => {
                const jobOption = `<option value="${job.name}">${job.name} (${job.type})</option>`;
                filterJob.insertAdjacentHTML('beforeend', jobOption);
            });
        }
        
        const jobSummaryEl = document.getElementById('jobSummary');
        if (jobSummaryEl) {
            if (jobs.length === 0) {
                jobSummaryEl.innerHTML = 
                    '<div class="text-amber-600 text-center">üìÅ Jobs folder is empty.</div>';
            } else {
                updateJobSummary();
            }
        }
        
        // DOMÏù¥ Ï§ÄÎπÑÎêú ÌõÑ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        setTimeout(() => {
            updateStats();
        }, 100);
        
    } catch (error) {
        console.error('Failed to load jobs:', error);
        showNotification('Unable to load job list: ' + error.message, 'error');
        
        jobs = [];
        const jobSummaryEl = document.getElementById('jobSummary');
        if (jobSummaryEl) {
            jobSummaryEl.innerHTML = 
                '<div class="text-red-600 text-center">‚ùå Failed to load jobs.</div>';
        }
    }
}

function initialize() {
    console.log('üöÄ Danal API Monitor Ï¥àÍ∏∞Ìôî ÏãúÏûë');
    
    // üî∏ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
    runningJobs.clear();
    console.log('[CLIENT INIT] runningJobs cleared');
    
    // Í∏∞Ï°¥ Ï¥àÍ∏∞Ìôî ÏΩîÎìú...
    fetchJobs();
    fetchHistory();
    
    if (typeof loadSchedules === 'function') loadSchedules();
    if (typeof connectSSE === 'function') connectSSE();
    if (typeof setupEventListeners === 'function') setupEventListeners();
    if (typeof updateCurrentTime === 'function') updateCurrentTime();
    
    setInterval(updateStats, 30000);
    if (typeof updateCurrentTime === 'function') {
        setInterval(updateCurrentTime, 1000);
    }
    
    console.log('‚úÖ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
}
let isInitialized = false;

function initializeWhenReady() {
    if (isInitialized) {
        console.log('[INIT] Already initialized, skipping');
        return;
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            if (!isInitialized) {
                isInitialized = true;
                initialize();
            }
        });
    } else {
        if (!isInitialized) {
            isInitialized = true;
            initialize();
        }
    }
}      
function updateJobSummary() {
    const jobSelectEl = document.getElementById('jobSelect');
    const summaryDiv = document.getElementById('jobSummary');
    
    if (!jobSelectEl || !summaryDiv) {
        return;
    }
    
    const jobName = jobSelectEl.value;
    const job = jobs ? jobs.find(j => j.name === jobName) : null;
    
    if (!job) {
        summaryDiv.innerHTML = '<div class="text-slate-400 text-center">Please select a job</div>';
        return;
    }
    
    const getFileName = (path) => {
        if (!path) return '-';
        return path.split('/').pop();
    };
    
    const chips = [
        `üìã Collection: ${getFileName(job.collection)}`,
        `üåç Environment: ${getFileName(job.environment)}`,
        `üìä Type: ${job.type || '-'}`
    ];
    
    summaryDiv.innerHTML = chips.map(chip => 
        `<div class="inline-block px-3 py-1.5 rounded-lg bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700 border border-indigo-200 mr-2 mb-2 text-xs font-medium">
            ${chip}
        </div>`
    ).join('');
}

        // ÏûëÏóÖ Ïã§Ìñâ
// ÏûëÏóÖ Ïã§Ìñâ Ìï®Ïàò (undefined Ïò§Î•ò ÏàòÏ†ï)
let runningJobs = new Set();

async function runJob(jobName) {
    const runBtn = document.getElementById('runBtn');
    
    console.log(`[CLIENT DEBUG] runJob Ìò∏Ï∂ú: ${jobName}`);
    console.log(`[CLIENT DEBUG] ÌòÑÏû¨ runningJobs:`, Array.from(runningJobs));
    console.log(`[CLIENT DEBUG] runningJobs.has(${jobName}):`, runningJobs.has(jobName));
    
    if (!jobName) {
        showNotification('Please select a job first', 'error');
        return;
    }
    
    // üî∏ Ï§ëÎ≥µ Ïã§Ìñâ Î∞©ÏßÄ - ÎîîÎ≤ÑÍπÖ Ï∂îÍ∞Ä
    if (runningJobs.has(jobName)) {
        console.log(`[CLIENT DEBUG] Ï§ëÎ≥µ Ïã§Ìñâ Ï∞®Îã®: ${jobName}`);
        showNotification(`Job "${jobName}" is already running`, 'warning');
        return;
    }
    
    if (!runBtn) {
        console.error('Run button not found');
        return;
    }
    
    try {
        // üî∏ Ïã§Ìñâ Ï§ë Î™©Î°ùÏóê Ï∂îÍ∞Ä
        runningJobs.add(jobName);
        console.log(`[CLIENT DEBUG] runningJobsÏóê Ï∂îÍ∞Ä: ${jobName}`, Array.from(runningJobs));
        
        runBtn.disabled = true;
        runBtn.innerHTML = '‚è≥ Running...';
        runBtn.classList.add('loading-shimmer');
        
        console.log(`[CLIENT] Starting job: ${jobName}`);
        
        const response = await fetch(`/api/run/${encodeURIComponent(jobName)}`, { 
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        let result;
        try {
            result = await response.json();
        } catch (jsonError) {
            console.error('Failed to parse JSON response:', jsonError);
            throw new Error(`Invalid server response (HTTP ${response.status})`);
        }
        
        console.log('[CLIENT] Job start result:', result);
        
        if (result.started === true) {
            showNotification(`Job "${jobName}" started successfully`, 'success');
            
            // ÏÉÅÌÉú Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
            running = { job: jobName, startAt: new Date().toISOString() };
            setStatusChip();
            
            // ÌûàÏä§ÌÜ†Î¶¨ ÏÉàÎ°úÍ≥†Ïπ®
            setTimeout(() => {
                fetchHistory();
            }, 1000);
        } else {
            const reason = result.reason || 'unknown_error';
            const reasonMessages = {
                'already_running': 'Another job is currently running. Please wait for it to complete.',
                'request_in_progress': 'This job request is already being processed.',
                'job_not_found': 'Job configuration file not found.',
                'unsupported_type': 'This job type is not supported.',
                'collection_not_found': 'Postman collection file not found.',
                'environment_not_found': 'Postman environment file not found.',
                'job_parse_error': 'Failed to parse job configuration file.',
                'no_collection_specified': 'No collection file specified in job configuration.',
                'invalid_job_name': 'Invalid job name provided.',
                'server_error': 'Server error occurred.',
                'unknown_error': 'An unknown error occurred.'
            };
            
            const reasonText = reasonMessages[reason] || result.message || `Error: ${reason}`;
            showNotification(`Execution failed: ${reasonText}`, 'error');
        }
    } catch (error) {
        console.error('Job execution failed:', error);
        let errorMessage = 'Network error occurred during job execution';
        
        if (error.message.includes('HTTP')) {
            errorMessage = `Server communication error: ${error.message}`;
        } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
            errorMessage = 'Connection failed. Please check if the server is running.';
        }
        
        showNotification(errorMessage, 'error');
    } finally {
        // üî∏ Ïã§Ìñâ ÏôÑÎ£å ÌõÑ Ï†ïÎ¶¨ - ÎîîÎ≤ÑÍπÖ Ï∂îÍ∞Ä
        console.log(`[CLIENT DEBUG] runningJobsÏóêÏÑú Ï†úÍ±∞ Ï†Ñ: ${jobName}`, Array.from(runningJobs));
        runningJobs.delete(jobName);
        console.log(`[CLIENT DEBUG] runningJobsÏóêÏÑú Ï†úÍ±∞ ÌõÑ: ${jobName}`, Array.from(runningJobs));
        
        runBtn.disabled = false;
        runBtn.innerHTML = 'Run';
        runBtn.classList.remove('loading-shimmer');
    }
}

// ÌûàÏä§ÌÜ†Î¶¨ Í∞ÄÏ†∏Ïò§Í∏∞ Ìï®Ïàò Í∞úÏÑ†
async function fetchHistory() {
    try {
        const filterJobEl = document.getElementById('filterJob');
        const rangeEl = document.getElementById('range');
        const searchTextEl = document.getElementById('searchText');
        
        const job = filterJobEl ? filterJobEl.value : '';
        const range = rangeEl ? rangeEl.value : '';
        const search = searchTextEl ? searchTextEl.value.trim() : '';
        
        const params = new URLSearchParams({
            page: currentPage || 1,
            size: pageSize || 10
        });
        
        if (job) params.append('job', job);
        if (range) params.append('range', range);
        if (search) params.append('search', search);
        
        const response = await fetch(`/api/history?${params}`);
        
        // üî∏ ÏÉÅÏÑ∏Ìïú Ïò§Î•ò Ï≤òÎ¶¨
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        running = data.running || null;
        setStatusChip();
        
        if (data.total !== undefined && data.totalPages !== undefined) {
            historyRaw = data.items || [];
            totalItems = data.total;
            totalPages = data.totalPages;
            currentPage = data.page || 1;
            historyView = historyRaw.slice();
        } else {
            historyRaw = data.items || data || [];
            historyView = historyRaw.slice();
            totalItems = historyView.length;
            totalPages = Math.ceil(totalItems / (pageSize || 10));
        }
        
        renderHistory();
        renderPagination();
        updateStats();
        
    } catch (error) {
        console.error('Failed to load history:', error);
        
        // üî∏ Îçî Íµ¨Ï≤¥Ï†ÅÏù∏ Ïò§Î•ò Î©îÏãúÏßÄ
        let errorMessage = 'Unable to load execution history';
        if (error.message.includes('HTTP 404')) {
            errorMessage = 'History API endpoint not found';
        } else if (error.message.includes('HTTP 500')) {
            errorMessage = 'Server error while loading history';
        } else if (error.name === 'TypeError') {
            errorMessage = 'Network connection error';
        }
        
        showNotification(errorMessage, 'error');
        
        // Ïò§Î•ò Ïãú Îπà ÏÉÅÌÉúÎ°ú ÏÑ§Ï†ï
        historyRaw = [];
        historyView = [];
        totalItems = 0;
        totalPages = 0;
        
        renderHistory();
        renderPagination();
        updateStats();
    }
}

        // ÏÉÅÌÉú Ïπ© ÏÑ§Ï†ï
function setStatusChip() {
  const chip = document.getElementById('statusChip');
     if (running) {
        chip.textContent = `üîÑ Running: ${running.job}`;
                chip.className = "text-xs px-3 py-2 rounded-full bg-gradient-to-r from-amber-100 to-orange-100 text-amber-700 border border-amber-200 animate-pulse shadow-sm";
            } else {
                chip.textContent = '‚è∏Ô∏è Standby';
                chip.className = "text-xs px-3 py-2 rounded-full bg-slate-200 text-slate-600 shadow-sm";
            }
        }

        // Ïù¥Î†• ÌÖåÏù¥Î∏î Î†åÎçîÎßÅ
// Í∏∞Ï°¥ renderHistory Ìï®Ïàò ÏàòÏ†ï - null Ï≤¥ÌÅ¨Îßå Ï∂îÍ∞Ä

function renderHistory() {
    const tbody = document.getElementById('histTbody');
    
    // üî∏ null Ï≤¥ÌÅ¨ Ï∂îÍ∞Ä
    if (!tbody) {
        console.warn('History table body (histTbody) not found');
        return;
    }
    
    tbody.innerHTML = '';
    
    if (historyView.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-8 text-slate-500">
                    <div class="flex flex-col items-center space-y-2">
                        <svg class="w-12 h-12 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>No execution history available</span>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    historyView.forEach(row => {
        const isSuccess = row.exitCode === 0;
        const duration = !row.duration && row.duration !== 0 ? '-' : 
            row.duration < 60 ? `${row.duration}Ï¥à` : 
            `${Math.floor(row.duration / 60)}Î∂Ñ ${row.duration % 60}Ï¥à`;
        
        const summaryText = row.summary || '';
        const summaryDisplay = summaryText.length > 50 ? 
            summaryText.substring(0, 50) + '...' : summaryText;
        const summaryTooltip = summaryText;
        
        // üî∏ ÌÜµÍ≥Ñ Ï†ïÎ≥¥ Ï∂îÍ∞Ä (ÏÑ†ÌÉùÏÇ¨Ìï≠)
        let statsInfo = '';
        if (row.stats) {
            const stats = row.stats;
            if (stats.totalRequests > 0) {
                const successRate = Math.round((stats.successfulRequests / stats.totalRequests) * 100);
                statsInfo = `<div class="text-xs text-slate-500">${successRate}% success (${stats.successfulRequests}/${stats.totalRequests})</div>`;
            }
            if (stats.avgResponseTime > 0) {
                statsInfo += `<div class="text-xs text-slate-500">Avg: ${stats.avgResponseTime}ms</div>`;
            }
        }
        
        tbody.insertAdjacentHTML('beforeend', `
            <tr class="hover:bg-slate-50 transition-colors duration-200 ${isSuccess ? 'hover:bg-emerald-50/40' : 'hover:bg-rose-50/40'}">
                <td class="py-3 pr-4 text-sm text-slate-600">${row.timestamp || ''}</td>
                <td class="py-3 pr-4 font-medium text-slate-800">${row.job || ''}</td>
                <td class="py-3 pr-4">
                    ${isSuccess ? 
                        '<span class="inline-flex items-center px-2 py-1 text-xs font-medium text-emerald-800 bg-emerald-100 rounded-full">‚úÖ Success</span>' :
                        '<span class="inline-flex items-center px-2 py-1 text-xs font-medium text-red-800 bg-red-100 rounded-full">‚ùå Failed</span>'
                    }
                </td>
                <td class="py-3 pr-4 text-sm text-slate-600" title="${summaryTooltip}">
                    ${summaryDisplay}
                    ${statsInfo}
                </td>
                <td class="py-3 pr-4 text-sm text-slate-600">${duration}</td>
                <td class="py-3 pr-4">
                    ${row.report ? 
                        `<a class="inline-flex items-center px-2 py-1 text-xs font-medium text-indigo-600 bg-indigo-50 rounded-md hover:bg-indigo-100 transition-colors" 
                           href="${row.report.replace(/^.*[\\/]reports[\\/]/, '/reports/')}" target="_blank">
                            HTML
                        </a>` : 
                        '<span class="text-slate-400 text-xs">-</span>'
                    }
                </td>
                <td class="py-3">
                    <a class="inline-flex items-center px-2 py-1 text-xs font-medium text-slate-600 bg-slate-50 rounded-md hover:bg-slate-100 transition-colors log-link" 
                       href="#" data-log-url="/logs/${row.stdout}">
                        stdout
                    </a>
                </td>
            </tr>
        `);
    });
}

        // ÌéòÏù¥Ïßï Î†åÎçîÎßÅ
function renderPagination() {
            const info = document.getElementById('paginationInfo');
            const controls = document.getElementById('paginationControls');
            
            if (totalItems === 0) {
                info.textContent = 'No data available';
                controls.innerHTML = '';
                return;
            }
            
            const startItem = (currentPage - 1) * pageSize + 1;
            const endItem = Math.min(currentPage * pageSize, totalItems);
            info.textContent = `${startItem}-${endItem} / ${totalItems} items (Page ${currentPage}/${totalPages})`;
            
            controls.innerHTML = '';
            
            if (currentPage > 1) {
                const firstBtn = createPaginationButton('‚è™', 'First page', () => {
                    currentPage = 1;
                    fetchHistory();
                });
                controls.appendChild(firstBtn);
                
                const prevBtn = createPaginationButton('‚óÄ Previous', 'Previous page', () => {
                    currentPage--;
                    fetchHistory();
                });
                controls.appendChild(prevBtn);
            }
            
            const maxVisible = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
            
            if (endPage - startPage + 1 < maxVisible) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            if (startPage > 1) {
                const pageBtn1 = createPaginationButton('1', 'First page', () => {
                    currentPage = 1;
                    fetchHistory();
                });
                controls.appendChild(pageBtn1);
                
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.className = 'px-2 py-1 text-slate-500 text-sm';
                    controls.appendChild(ellipsis);
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = createPaginationButton(
                    i.toString(), 
                    `Page ${i}`, 
                    () => {
                        currentPage = i;
                        fetchHistory();
                    },
                    i === currentPage
                );
                controls.appendChild(pageBtn);
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.className = 'px-2 py-1 text-slate-500 text-sm';
                    controls.appendChild(ellipsis);
                }
                
                const lastBtn = createPaginationButton(totalPages.toString(), 'Last page', () => {
                    currentPage = totalPages;
                    fetchHistory();
                });
                controls.appendChild(lastBtn);
            }
            
            if (currentPage < totalPages) {
                const nextBtn = createPaginationButton('Next ‚ñ∂', 'Next page', () => {
                    currentPage++;
                    fetchHistory();
                });
                controls.appendChild(nextBtn);
                
                const lastBtn = createPaginationButton('‚è©', 'Last page', () => {
                    currentPage = totalPages;
                    fetchHistory();
                });
                controls.appendChild(lastBtn);
            }
        }
        function normalizeHistoryData(historyData) {
    if (!historyData) return [];
    
    return historyData.map(item => {
        // ÌååÏùºÎ™ÖÎßå Ï∂îÏ∂úÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
        const getBasename = (filePath) => {
            if (!filePath) return null;
            if (typeof filePath !== 'string') return null;
            
            // Í≤ΩÎ°úÏóêÏÑú ÌååÏùºÎ™ÖÎßå Ï∂îÏ∂ú
            const parts = filePath.replace(/\\/g, '/').split('/');
            return parts[parts.length - 1];
        };
        
        // Í∏∞Ï°¥ ÌòïÏãùÍ≥º ÏÉà ÌòïÏãù Î™®Îëê ÏßÄÏõê
        const normalized = {
            id: item.id || item.timestamp || `${Date.now()}-${Math.random()}`,
            jobName: item.jobName || item.job || 'Unknown Job',
            job: item.job || item.jobName || 'Unknown Job',
            startTime: item.startTime || item.timestamp,
            endTime: item.endTime || item.timestamp,
            timestamp: item.timestamp || item.startTime,
            status: item.status || (item.exitCode === 0 ? 'success' : 'failed'),
            exitCode: item.exitCode || 0,
            duration: item.duration || 0,
            summary: item.summary || 'No summary available',
            htmlReport: item.htmlReport || (item.report ? getBasename(item.report) : null),
            junitReport: item.junitReport || null,
            jsonReport: item.jsonReport || null,
            stats: item.stats || item.detailedStats || null
        };
        
        return normalized;
    });
}
        // ÌéòÏù¥Ïßï Î≤ÑÌäº ÏÉùÏÑ± Ìó¨Ìçº
        function createPaginationButton(text, title, onClick, isActive = false) {
            const btn = document.createElement('button');
            btn.textContent = text;
            btn.title = title;
            btn.onclick = onClick;
            
            if (isActive) {
                btn.className = 'px-3 py-2 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-lg text-sm font-medium shadow-md';
            } else {
                btn.className = 'px-3 py-2 border border-slate-200 rounded-lg hover:bg-slate-50 text-sm font-medium transition-all duration-200 hover:shadow-md';
            }
            
            return btn;
        }

        // SSE Ïó∞Í≤∞
        function connectSSE() {
    if (stateSource) stateSource.close();
    stateSource = new EventSource('/api/stream/state');
    
    stateSource.onmessage = function(event) {
        try {
            const data = JSON.parse(event.data);
            running = data.running;
            setStatusChip();
            
            // üî∏ ÏÑúÎ≤Ñ ÏÉÅÌÉúÏôÄ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉÅÌÉú ÎèôÍ∏∞Ìôî
            if (!running) {
                // ÏÑúÎ≤ÑÏóêÏÑú Ïã§Ìñâ Ï§ëÏù∏ ÏûëÏóÖÏù¥ ÏóÜÏúºÎ©¥ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ÎèÑ Ï†ïÎ¶¨
                if (runningJobs.size > 0) {
                    console.log('[CLIENT SYNC] ÏÑúÎ≤Ñ ÏÉÅÌÉúÏóê ÎßûÏ∂∞ runningJobs Ï†ïÎ¶¨');
                    runningJobs.clear();
                }
            }
            
            if (data.last) {
                fetchHistory();
            }
        } catch (error) {
            console.error('State stream parsing error:', error);
        }
    };
    
    stateSource.onerror = function(error) {
        console.error('State stream error:', error);
        setTimeout(connectSSE, 5000);
    };
    
    if (logSource) logSource.close();
    logSource = new EventSource('/api/stream/logs');
    
    logSource.onmessage = function(event) {
        try {
            const data = JSON.parse(event.data);
            addLogLine(data.line);
        } catch (error) {
            console.error('Log stream parsing error:', error);
        }
    };
    
    logSource.onerror = function(error) {
        console.error('Log stream error:', error);
        setTimeout(() => {
            logSource = new EventSource('/api/stream/logs');
        }, 5000);
    };
}
function clearRunningJobs() {
    console.log('[CLIENT] runningJobs Í∞ïÏ†ú Ï¥àÍ∏∞Ìôî');
    runningJobs.clear();
    showNotification('Client running jobs cleared', 'info');
}
        // Î°úÍ∑∏ Ï∂îÍ∞Ä
        function appendLog(line) {
            const console1 = document.getElementById('console');
            const console2 = document.getElementById('modalConsole');
            
            const logEntry = `<div class="hover:bg-slate-800 px-2 py-1 rounded transition-colors">${escapeHtml(line)}</div>`;
            
            console1.insertAdjacentHTML('beforeend', logEntry);
            console2.insertAdjacentHTML('beforeend', logEntry);
            
            console1.scrollTop = console1.scrollHeight;
            console2.scrollTop = console2.scrollHeight;
            
            limitLogLines(console1);
            limitLogLines(console2);
        }

        // Î°úÍ∑∏ ÎùºÏù∏ Ïàò Ï†úÌïú
        function limitLogLines(element, maxLines = 1000) {
            const lines = element.children;
            if (lines.length > maxLines) {
                for (let i = 0; i < lines.length - maxLines; i++) {
                    element.removeChild(lines[0]);
                }
            }
        }

        // ÏΩòÏÜî ÎèôÍ∏∞Ìôî
        function syncConsoles() {
            const console1 = document.getElementById('console');
            const console2 = document.getElementById('modalConsole');
            console2.innerHTML = console1.innerHTML;
            console2.scrollTop = console2.scrollHeight;
        }

        // Î°úÍ∑∏ ÌååÏùº Î≥¥Í∏∞
        async function showLogFile(logUrl) {
            try {
                const response = await fetch(logUrl);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const content = await response.text();
                document.getElementById('fileModalTitle').textContent = `Log File: ${logUrl}`;
                document.getElementById('fileContent').textContent = content;
                document.getElementById('fileModal').classList.remove('hidden');
                
            } catch (error) {
                console.error('Log file load failed:', error);
                showNotification('Unable to load log file.', 'error');
            }
        }

        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò Í∞úÏÑ† (ÌèâÍ∑† ÏùëÎãµÏãúÍ∞ÑÏùÑ Ïú†Ïö©Ìïú Îç∞Ïù¥ÌÑ∞Î°ú)
function updateStats() {
    // Ïã§Ï†ú HTMLÏóê ÏûàÎäî IDÎì§ ÌôïÏù∏
    const totalSuccessEl = document.getElementById('totalSuccess');
    const avgResponseEl = document.getElementById('avgResponse');
    const activeJobsEl = document.getElementById('activeJobs');
    const todayRunsEl = document.getElementById('todayRuns');
    
    // DOM ÏöîÏÜå Ï°¥Ïû¨ ÌôïÏù∏ ÌõÑ ÏïàÏ†ÑÌïòÍ≤å ÏóÖÎç∞Ïù¥Ìä∏
    if (totalSuccessEl) {
        if (!historyRaw || historyRaw.length === 0) {
            totalSuccessEl.textContent = '-%';
        } else {
            const successCount = historyRaw.filter(h => h.exitCode === 0).length;
            const successRate = Math.round((successCount / historyRaw.length) * 100);
            totalSuccessEl.textContent = `${successRate}%`;
        }
    }

    if (avgResponseEl) {
        if (!historyRaw || historyRaw.length === 0) {
            avgResponseEl.textContent = '-ms';
            avgResponseEl.className = 'text-xl font-bold text-blue-700';
        } else {
            // ÏµúÍ∑º ÏÑ±Í≥µÌïú Ïã§ÌñâÎì§Ïùò ÌèâÍ∑† ÏùëÎãµÏãúÍ∞Ñ Í≥ÑÏÇ∞
            const recentSuccessful = historyRaw
                .filter(h => h.exitCode === 0 && h.stats && h.stats.avgResponseTime > 0)
                .slice(0, 20);
            
            if (recentSuccessful.length > 0) {
                const avgResponseTime = Math.round(
                    recentSuccessful.reduce((sum, h) => sum + h.stats.avgResponseTime, 0) / recentSuccessful.length
                );
                avgResponseEl.textContent = `${avgResponseTime}ms`;
                
                // ÏùëÎãµÏãúÍ∞ÑÏóê Îî∞Î•∏ ÏÉâÏÉÅ Î≥ÄÍ≤Ω
                if (avgResponseTime < 1000) {
                    avgResponseEl.className = 'text-xl font-bold text-green-700';
                } else if (avgResponseTime < 3000) {
                    avgResponseEl.className = 'text-xl font-bold text-yellow-700';
                } else {
                    avgResponseEl.className = 'text-xl font-bold text-red-700';
                }
            } else {
                // ÌÜµÍ≥ÑÏóêÏÑú ÎûúÎç§ ÏùëÎãµÏãúÍ∞Ñ ÏÇ¨Ïö© (Í∏∞Ï°¥ Î°úÏßÅ Ïú†ÏßÄ)
                const avgResponseTime = Math.round(Math.random() * 500 + 200);
                avgResponseEl.textContent = `${avgResponseTime}ms`;
                avgResponseEl.className = 'text-xl font-bold text-blue-700';
            }
        }
    }

    if (activeJobsEl) {
        activeJobsEl.textContent = jobs ? jobs.length.toString() : '0';
    }

    if (todayRunsEl) {
        if (!historyRaw || historyRaw.length === 0) {
            todayRunsEl.textContent = '-';
        } else {
            // Ïò§Îäò Ïã§ÌñâÎêú ÏûëÏóÖ Ïàò Í≥ÑÏÇ∞
            const today = new Date().toDateString();
            const todayCount = historyRaw.filter(h => {
                if (!h.timestamp) return false;
                const histDate = new Date(h.timestamp).toDateString();
                return histDate === today;
            }).length;
            todayRunsEl.textContent = todayCount.toString();
        }
    }
}

        // ÏïåÎ¶º ÌëúÏãú
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
            
            const colors = {
                success: 'bg-emerald-500 text-white',
                error: 'bg-red-500 text-white',
                warning: 'bg-amber-500 text-white',
                info: 'bg-blue-500 text-white'
            };
            
            notification.className += ` ${colors[type] || colors.info}`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
                        ‚úï
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // HTML Ïù¥Ïä§ÏºÄÏù¥ÌîÑ
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ÌéòÏù¥ÏßÄ Ïñ∏Î°úÎìú Ïãú Ï†ïÎ¶¨
        window.addEventListener('beforeunload', () => {
            if (stateSource) stateSource.close();
            if (logSource) logSource.close();
        });
    initializeWhenReady();
    </script>
</body>
</html>