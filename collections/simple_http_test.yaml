# 간단한 HTTP POST 테스트
name: "HTTP POST 기본 테스트"
description: "HTTP POST 요청 기본 테스트"
version: "1.0.0"

variables:
  TEST_URL: "https://httpbin.org/post"
  TEST_MESSAGE: "Hello from YAML HTTP Test"
  USER_ID: "{{js: 'user_' + Date.now()}}"

steps:
  # HTTP POST 테스트
  - name: "HTTP POST 요청 테스트"
    description: "httpbin.org에 POST 요청 전송"
    type: "http"

    args:
      url: "{{TEST_URL}}"
      headers:
        Content-Type: "application/x-www-form-urlencoded"
        X-Test-Header: "YAML-HTTP-Test"
        User-Agent: "2uknow-api-monitor/1.0.0"
      body: "message={{TEST_MESSAGE}}&user_id={{USER_ID}}&timestamp={{$timestamp}}"

    extract:
      - name: "status"
        pattern: "status"
        variable: "HTTP_STATUS"
      - name: "body"
        pattern: "body"
        variable: "RESPONSE_BODY"
      # JSON에서 특정 필드 추출
      - name: "origin"
        pattern: '"origin"\\s*:\\s*"([^"]+)"'
        variable: "CLIENT_IP"

    test:
      - name: "HTTP 응답 상태 확인"
        description: "HTTP 200 OK 응답 확인"
        assertion: "HTTP_STATUS == 200"
      - name: "응답 본문 존재 확인"
        description: "응답 본문이 존재하는지 확인"
        assertion: "RESPONSE_BODY exists"
      - name: "POST 데이터 에코 확인"
        description: "전송한 데이터가 응답에 포함되어 있는지 확인"
        assertion: "js: RESPONSE_BODY && RESPONSE_BODY.includes(TEST_MESSAGE)"
      - name: "클라이언트 IP 추출 확인"
        description: "클라이언트 IP가 정상적으로 추출되었는지 확인"
        assertion: "CLIENT_IP exists"

options:
  stopOnError: false
  timeout: 30000