# SClient 간단한 테스트 시나리오 (YAML)
name: "SKT SMS 정상케이스"
description: "SClient 바이너리를 사용한 ITEMSEND2 완전 기능 테스트"
version: "1.0.0"

# 변수 정의
variables:
  MERCHANT_ID: "A010002002"
  MERCHANT_PWD: "bbbbb"
  SERVICE_NAME: "TELEDIT"
  USER_ID: "kmhwang"
  ORDER_ID: "{{js: 'ORD' + Date.now() + '_' + Math.floor(Math.random() * 1000)}}"
  EMAIL: "2uknow@danal.co.kr"
  DYNAMIC_PREFIX: "{{js: new Date().getHours() > 12 ? 'PM' : 'AM'}}"
  
  # SKT 비밀번호 체크용 변수
  IDEN: "9002051"
  DST_ADDR: "01046911117"
  CARRIER: "SKT"
  AMOUNT: "1000"

# 시나리오 단계
steps:
  - name: "1차 호출 : ITEMSEND2"
    
    args:
      Command: "ITEMSEND2"
      Configure: "FAILURE"
      SERVICE: "{{SERVICE_NAME}}"
      ItemType: "Amount"
      ItemCount: "1"
      OUTPUTOPTION: "DEFAULT"
      ID: "{{MERCHANT_ID}}"
      PWD: "{{MERCHANT_PWD}}"
      ItemInfo: "2|1000|1|22S0HZ0100|상품명"
      SUBCP: "DETEST"
      USERID: "{{USER_ID}}"
      ORDERID: "{{ORDER_ID}}"
      IsPreOtbill: "N"
      IsOpenMarket: "N"
      SellerName: ""
      SellerTel: ""
      IsSubscript: "N"
      EMAIL: "{{EMAIL}}"
          
    
    # 응답 데이터 추출
    extract:
      - name: "result"
        pattern: "Result"
        variable: "RESULT_CODE"
      - name: "serverInfo"
        pattern: "ServerInfo"
        variable: "SERVER_1"
      - name: "errMsg"
        pattern: "ErrMsg"
        variable: "ERROR_MESSAGE"
    
    ########################################################### Assertion ###########################################################
    test:
      - name: "결과 코드(RESULT) 정상 출력"
        assertion: "RESULT_CODE == 0"

      - name: "거래 인증 key(ServerInfo) 정상 출력"
        assertion: "js: SERVER_1 !== null && SERVER_1.trim().length > 0 && RESULT_CODE !== '0'"

      - name: "결과 메시지(ErrMsg) 정상 출력"
        assertion: "ERROR_MESSAGE == No Information"

  - name: "2차 호출 : IDELIVER"
    
    args:
      ServerInfo: "{{SERVER_1}}"
      IDEN: "{{IDEN}}"
      ISPREOTBILL: "N"
      DSTADDR: "{{DST_ADDR}}"
      CARRIER: "{{CARRIER}}"
      WPAGE: "WEB"
      PRCODE: ""
      AMOUNT: "{{AMOUNT}}"
      TERMSAGREE3: "N"
      IFVERSION: "V1.1.7"      
      TERMSAGREE2: "N|N"
      OUTPUTOPTION: "1"
      COMMAND: "IDELIVER"
      TERMSAGREE1: "Y"
      IPADDR : "10.10.52.54"
      SMTOTP: "N"
      ISCPIN: "Y"
      CPIN: "663466"
    
    # 응답 데이터 추출
    extract:
      - name: "result"
        pattern: "Result"
        variable: "ID_RESULT"
      - name: "serverInfo"
        pattern: "ServerInfo"
        variable: "ID_SERVER_INFO"
      - name: "errMsg"
        pattern: "ErrMsg"
        variable: "ID_ERROR_MSG"
      - name: "cap"
        pattern: "CAP"
        variable: "ID_CAP"
      - name: "ANSIMMEMBER"
        pattern: "ANSIMMEMBER"
        variable: "ID_ANSIMMEMBER"
      - name: "ARSCHANGE"
        pattern: "ARSCHANGE"
        variable: "ID_ARSCHANGE"
      - name: "UAM"
        pattern: "UAM"
        variable: "ID_UAM"
      - name: "ISLGPWDUSER"
        pattern: "ISLGPWDUSER"
        variable: "ID_ISLGPWDUSER"
      - name: "ISPROM"
        pattern: "ISPROM"
        variable: "ID_ISPROM"
      - name: "PROM_AMT"
        pattern: "PROM_AMT"
        variable: "ID_PROM_AMT"
      - name: "ISCARRIERPROM"
        pattern: "ISCARRIERPROM"
        variable: "ID_ISCARRIERPROM"

    
    ########################################################### Assertion ###########################################################
    test:
      - name: "거래 인증 key(ServerInfo) 정상 출력"
        assertion: "js: ID_SERVER_INFO && ID_SERVER_INFO.length > 0 && ID_RESULT == 0"

      - name: "결과 코드(RESULT) 정상 출력"
        assertion: "ID_RESULT == 0"

      - name: "결과 메시지(ErrMsg) 정상 출력" 
        assertion: "ID_ERROR_MSG == No Information"

      # 개인정보 (잔여한도 금액) 미전달
      - name: "잔여한도 금액(CAP) 정상 출력"
        assertion: "ID_CAP == 000000"

      - name: "안심결제 회원 여부(ANSIMMEMBER) 정상 출력"
        assertion: "ID_ANSIMMEMBER == N"

      - name: "ARS 전환 지원(ARSCHANGE) 정상 출력"
        assertion: "ID_ARSCHANGE == N"

      - name: "ARS 전환 지원(ARSCHANGE) 정상 출력"
        assertion: "ID_ARSCHANGE == N"

      - name: "ARS 전환 지원(ARSCHANGE) 정상 출력"
        assertion: "ID_ARSCHANGE == N"

      - name: "ARS 전환 지원(ISPROM) 정상 출력"
        assertion: "ID_ISPROM == N"
      



# 시나리오 설정
options:
  stopOnError: false
  timeout: 15000
  retryCount: 0