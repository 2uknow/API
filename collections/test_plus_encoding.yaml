name: "+ 기호 인코딩 테스트"
description: "HTTP POST에서 + 기호가 %2B로 올바르게 인코딩되는지 확인"
version: "1.0.0"

variables:
  PCANCEL_CRYPTOKEY: "84f889e76a734d9d44f0634d2f0eec15"
  PCANCEL_URL: "https://ui.teledit.com/Danal/DGW/PCancel/Cancel.php"
  CPID: "A010002002"
  ISCHARSET: "UTF-8"
  TEST_DATA: "TID=++++test++++|PWD=++++pass++++|ORDERID=++++order++++|CAMT=150"

steps:
  - name: "암호화 (+ 기호 다수 포함)"
    description: "+ 기호가 많이 포함된 데이터를 암호화"
    type: "crypto"

    args:
      operation: "encrypt"
      key: "{{PCANCEL_CRYPTOKEY}}"
      data: "{{TEST_DATA}}"

    extract:
      - name: "result"
        pattern: "result"
        variable: "ENCRYPTED_DATA"

    test:
      - "ENCRYPTED_DATA exists"

  - name: "HTTP POST 테스트 (+ 기호 인코딩 확인)"
    description: "암호화된 데이터를 HTTP POST로 전송하여 + 기호 인코딩 확인"
    type: "http"

    args:
      url: "{{PCANCEL_URL}}"
      method: "POST"
      headers:
        Content-Type: "application/x-www-form-urlencoded"
        User-Agent: "2uknow-api-monitor/1.0.0"
      body: "DATA={{ENCRYPTED_DATA}}&CPID={{CPID}}&ISCHARSET={{ISCHARSET}}"

    extract:
      - name: "status"
        pattern: "status"
        variable: "HTTP_STATUS"
      - name: "body"
        pattern: "body"
        variable: "RESPONSE_BODY"

    test:
      - name: "HTTP 응답 상태 확인"
        assertion: "HTTP_STATUS == 200"
      - name: "응답 본문 존재 확인"
        assertion: "RESPONSE_BODY exists"

options:
  stopOnError: false
  timeout: 15000